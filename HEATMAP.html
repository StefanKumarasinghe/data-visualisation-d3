<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">
<!-- Load color palettes -->
<title>Data Visualisation</title>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

<Style>
  * {font-family:  "Quicksand", sans-serif;}
  .big-font {
    font-size: 20px;
  }
  .legend-box {
    width: 30px;
    height: 30px;
    border-radius:20px;
    display: inline-block;

}
.range-slider {
        position: relative;
        margin: 10px 0;
    }

    .range-slider input[type="range"] {
        position: absolute;
        width: 100%;
        height: 5px;
        -webkit-appearance: none;
        background-color: #ddd;
        border-radius: 5px;
    }

    .range-slider input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background-color: #007bff;
        border-radius: 50%;
        cursor: pointer;
        position: relative;
        z-index: 1;
    }
.round {
  border-radius:30px;
}
</Style>

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<!-- Create a div where the graph will take place -->
<body class="bg-light">
  <div class="bg-danger p-5 text-white "><h1 style="font-weight:200">Data Visualization</h1><p>Data Visualisation Group Project By Stefan Kumarasinghe & Zuzanna .....</p></div>
<div class="d-flex p-3 pt-2 mt-5  justify-content-center">
<div class="col-md-6">
<h2 class="text-center">Heatmap</h2>
<div id="my_dataviz"></div>
</div>
<div class="h-100 col-md-5 mx-5">
<h3 class="text-center">Interactive Tools</h3>
<div  class="round p-3 mx-5 mt-5 shadow card-body">
  <h4 class="mt-3 d-inline ">Legends</h4><a class="px-3" href="">Randomize Color Scheme</a>
  <div class="row mt-3">
    <div class="col">
        <div class="legend-box round" style="background-color: #17f3ff;"></div> >70%
    </div>
    <div class="col">
        <div class="legend-box round" style="background-color: #8706b2;"></div> 70%-76%
    </div>
    <div class="col">
        <div class="legend-box round" style="background-color: #e591ce;"></div> 76%-82%
    </div>
    <div class="col">
        <div class="legend-box round" style="background-color: #ebff38;"></div> 82%-88%
    </div>
    <div class="col">
        <div class="legend-box round" style="background-color: #ff8800;"></div> 88%-94%
    </div>
    <div class="col">
        <div class="legend-box round" style="background-color: #ff4a4a;"></div> 94%-99%
    </div>
    <div class="col my-3">
        <div class="legend-box round" style="background-color: #dd000f;"></div> 100%
    </div>
</div>
<div class=" mt-4">
  <h4>Data Regressed</h4>
  <div class="form-group">

    <select class="form-control py-3 fw-bold mt-3" id="dataOptions" onchange="changeData()">
      <option value="raw">Uncleaned Data</option>
      <option value="cleaned">Regressed Data</option>
      <option value="combined">Combined Data</option>
  </select>
  

  </div>
  <!-- Timeline Range Slider -->
<div class="my-4 col-9 range-slider">
    <input type="range" class="custom-range" id="startYear" min="2010" max="2022" value="2010">
    <input type="range" class="custom-range" id="endYear" min="2010" max="2022" value="2022">
</div>
<div class="row mt-2 pt-4">
    <div class="col-7 fw-bold">
        <label for="startYear">Start Year:</label>
        <output id="startYearOutput">2010</output>
    </div>
    <div class="col-4 fw-bold">
        <label for="endYear">End Year:</label>
        <output id="endYearOutput">2022</output>
    </div>
</div>
</div>
<div class="row">
    <div class="col-6">
<h4 class="my-3">Countries</h4>
<div style="height:300px; overflow:auto" class="">
    <div class="form-group">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryAustralia" value="Australia" data-continent="Australia">
            <label class="form-check-label" for="countryAustralia">Australia</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryAustria" value="Austria" data-continent="Europe">
            <label class="form-check-label" for="countryAustria">Austria</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryBelgium" value="Belgium" data-continent="Europe">
            <label class="form-check-label" for="countryBelgium">Belgium</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryCanada" value="Canada" data-continent="North America">
            <label class="form-check-label" for="countryCanada">Canada</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryCzechia" value="Czechia" data-continent="Europe">
            <label class="form-check-label" for="countryCzechia">Czechia</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryDenmark" value="Denmark" data-continent="Europe">
            <label class="form-check-label" for="countryDenmark">Denmark</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryFinland" value="Finland" data-continent="Europe">
            <label class="form-check-label" for="countryFinland">Finland</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryFrance" value="France" data-continent="Europe">
            <label class="form-check-label" for="countryFrance">France</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryGermany" value="Germany" data-continent="Europe">
            <label class="form-check-label" for="countryGermany">Germany</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryGreece" value="Greece" data-continent="Europe">
            <label class="form-check-label" for="countryGreece">Greece</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryHungary" value="Hungary" data-continent="Europe">
            <label class="form-check-label" for="countryHungary">Hungary</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryIceland" value="Iceland" data-continent="Europe">
            <label class="form-check-label" for="countryIceland">Iceland</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryIreland" value="Ireland" data-continent="Europe">
            <label class="form-check-label" for="countryIreland">Ireland</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryItaly" value="Italy" data-continent="Europe">
            <label class="form-check-label" for="countryItaly">Italy</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryJapan" value="Japan" data-continent="Asia">
            <label class="form-check-label" for="countryJapan">Japan</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryKorea" value="Korea" data-continent="Asia">
            <label class="form-check-label" for="countryKorea">Korea</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryLuxembourg" value="Luxembourg" data-continent="Europe">
            <label class="form-check-label" for="countryLuxembourg">Luxembourg</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryMexico" value="Mexico" data-continent="North America">
            <label class="form-check-label" for="countryMexico">Mexico</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryNetherlands" value="Netherlands" data-continent="Europe">
            <label class="form-check-label" for="countryNetherlands">Netherlands</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryNewZealand" value="New Zealand" data-continent="Oceania">
            <label class="form-check-label" for="countryNewZealand">New Zealand</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryNorway" value="Norway" data-continent="Europe">
            <label class="form-check-label" for="countryNorway">Norway</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryPoland" value="Poland" data-continent="Europe">
            <label class="form-check-label" for="countryPoland">Poland</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryPortugal" value="Portugal" data-continent="Europe">
            <label class="form-check-label" for="countryPortugal">Portugal</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countrySlovak Republic" value="Slovak Republic" data-continent="Europe">
            <label class="form-check-label" for="countrySlovak Republic">Slovak Republic</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countrySpain" value="Spain" data-continent="Europe">
            <label class="form-check-label" for="countrySpain">Spain</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countrySweden" value="Sweden" data-continent="Europe">
            <label class="form-check-label" for="countrySweden">Sweden</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countrySwitzerland" value="Switzerland" data-continent="Europe">
            <label class="form-check-label" for="countrySwitzerland">Switzerland</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryTürkiye" value="Türkiye" data-continent="Asia">
            <label class="form-check-label" for="countryTürkiye">Türkiye</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryUnited Kingdom" value="United Kingdom" data-continent="Europe">
            <label class="form-check-label" for="countryUnited Kingdom">United Kingdom</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryUnited States" value="United States" data-continent="North America">
            <label class="form-check-label" for="countryUnited States">United States</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryChile" value="Chile" data-continent="South America">
            <label class="form-check-label" for="countryChile">Chile</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryEstonia" value="Estonia" data-continent="Europe">
            <label class="form-check-label" for="countryEstonia">Estonia</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryIsrael" value="Israel" data-continent="Asia">
            <label class="form-check-label" for="countryIsrael">Israel</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countrySlovenia" value="Slovenia" data-continent="Europe">
            <label class="form-check-label" for="countrySlovenia">Slovenia</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryRussia" value="Russia" data-continent="Europe">
            <label class="form-check-label" for="countryRussia">Russia</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryColombia" value="Colombia" data-continent="South America">
            <label class="form-check-label" for="countryColombia">Colombia</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryLithuania" value="Lithuania" data-continent="Europe">
            <label class="form-check-label" for="countryLithuania">Lithuania</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryCosta Rica" value="Costa Rica" data-continent="North America">
            <label class="form-check-label" for="countryCosta Rica">Costa Rica</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryLatvia" value="Latvia" data-continent="Europe">
            <label class="form-check-label" for="countryLatvia">Latvia</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="countryRomania" value="Romania" data-continent="Europe">
            <label class="form-check-label" for="countryRomania">Romania</label>
        </div>
      </div>
      
</div>
</div>
<div class="col-6 mt-3">
    <h4>Continent</h4>
    <div class="form-check mt-3">
        <input class="form-check-input" type="checkbox" id="continentEurope" value="Europe">
        <label class="form-check-label" for="continentEurope">Europe</label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" id="continentAsia" value="Asia">
        <label class="form-check-label" for="continentAsia">Asia</label>
    </div>

    <div class="form-check">
        <input class="form-check-input" type="checkbox" id="continentAustralia" value="Australia">
        <label class="form-check-label" for="continentAustralia">Australia</label>
    </div>
</div>

</div>
<script>
    // Function to handle continent checkbox click event
function handleContinentCheckboxClick(continent) {
    // Get all country checkboxes for the selected continent
    var countryCheckboxes = document.querySelectorAll('input[type="checkbox"][data-continent="' + continent + '"]');

    // Check or uncheck country checkboxes based on the state of the continent checkbox
    var continentCheckbox = document.getElementById('continent' + continent);
    countryCheckboxes.forEach(function(checkbox) {
        checkbox.checked = continentCheckbox.checked;
    });
}

document.getElementById('continentEurope').addEventListener('click', function() {
    handleContinentCheckboxClick('Europe');
});

document.getElementById('continentAustralia').addEventListener('click', function() {
    handleContinentCheckboxClick('Australia');
});



document.getElementById('continentAsia').addEventListener('click', function() {
    handleContinentCheckboxClick('Asia');
});




</script>

  
  
</div>
</div>
</div>


<script>
    function changeData() {
        var selectBox = document.getElementById("dataOptions");
        var selectedValue = selectBox.options[selectBox.selectedIndex].value;
        var filename;

        // Set the filename based on the selected option
        switch (selectedValue) {
            case 'raw':
                filename = "HEAT.csv";
                break;
            case 'cleaned':
                filename = "HEAT_REGRESSED.csv";
                break;
            case 'combined':
                filename = "COMBINED_DATA.csv"; // Change to your combined data filename
                break;
            default:
                // Default to raw data if none selected
                filename = "HEAT.csv";
                break;
        }
        d3.select("#my_dataviz").selectAll("*").remove();
        // set the dimensions and margins of the graph
        var margin = { top: 80, right: 25, bottom: 30, left: 120 },
            width = 700 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Read the data
        d3.csv(filename, function (data) {

            // Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
            var myGroups = d3.map(data, function (d) { return d.Year; }).keys()
            var myVars = d3.map(data, function (d) { return d.Country; }).keys()

            // Build X scales and axis:
            var x = d3.scaleBand()
                .range([0, width])
                .domain(myGroups)
                .padding(0.05);
            svg.append("g")
                .style("font-size", 15)
                .attr("transform", "translate(0," + height + ")")
                .attr('class','x-axis-label')
                .call(d3.axisBottom(x).tickSize(0))
                .style("font-family", "Quicksand")
                .style("font-weight", "1000")
                .select(".domain").remove()

            // Build Y scales and axis:
            var y = d3.scaleBand()
                .range([height, 0])
                .domain(myVars)
                .padding(0.3);
            svg.append("g")
                .style("font-size", 15)
                .style("font-family", "Quicksand")
                .style("font-weight", "1000")
                .attr('class','y-axis-label')
                .call(d3.axisLeft(y).tickSize(0))
                .select(".domain").remove()

            // Build color scale
            var myColor = d3.scaleSequential()
                .domain([70, 76, 82, 88, 94, 100])
                .interpolator(function (value) {
                    console.log(value)
                    if (value == 5) return "#dd000f";  // Equal to 5 (dark red)
                    else if (value < 5 && value >= 4) return "#ff4a4a";   // Range: (4, 5) (dark red shade 1)
                    else if (value < 4 && value >= 3) return "#ff8800";   // Range: (3, 4) (dark red shade 2)
                    else if (value < 3 && value >= 2) return "#ebff38";   // Range: (2, 3) (red shade 1)
                    else if (value < 2 && value >= 1) return "#e591ce";
                    else if (value < 1 && value >= 0) return "#8706b2";   // Range: (1, 2) (red shade 2)
                    else return "#73d7ff";
                });

            // create a tooltip
            var tooltip = d3.select("#my_dataviz")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "black")
                .style("color", "white")
                .style("border", "solid")
                .style("position", "absolute")
                .style('top', '0')
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "20px")

            // Three function that change the tooltip when user hover / move / leave a cell
            var mouseover = function (d) {
                tooltip
                    .style("opacity", 1)
                d3.select(this)
                    .style("stroke", "black")
                    .style("opacity", 1)
            }
            var mousemove = function (d) {
                tooltip
                    .html(d.Country + " - " + d.Year + "<br>" + d.Value)
                    .style("left", (d3.mouse(this)[0] + 70) + "px")
                    .style("top", (d3.mouse(this)[1]) + "px")
            }
            var mouseleave = function (d) {
                tooltip
                    .style("opacity", 0)
                d3.select(this)
                    .style("stroke", "none")
                    .style("opacity", 0.8)
            }

            // add the squares
            svg.selectAll()
                .data(data, function (d) { return d.Year + ':' + d.Country; })
                .enter()
                .append("rect")
                .attr("x", function (d) { return x(d.Year) })
                .attr("y", function (d) { return y(d.Country) })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", function (d) { return myColor(d.Value) })
                .style("stroke-width", 4)
                .style("stroke", "none")
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
        });

        // Add title to graph
        svg.append("text")
            .attr("x", 0)
            .attr("y", -30)
            .attr("text-anchor", "left")
            .style("font-size", "22px")
            .text("Health care coverage and life expectancy over the years");

        // Add subtitle to graph
        svg.append("text")
            .attr("x", 0)
            .attr("y", -10)
            .attr("text-anchor", "left")
            .style("font-size", "14px")
            .style("fill", "grey")
            .style("max-width", 400)
            .text("The colors represent the intensity of coverage");

    }
    changeData()
</script>
<script>
    function handleRangeChange() {
        var startYear = document.getElementById("startYear").value;
        var endYear = document.getElementById("endYear").value;
        document.getElementById("startYearOutput").textContent = startYear;
        document.getElementById("endYearOutput").textContent = endYear;
        drawHeatmap();
    }

    document.getElementById("startYear").addEventListener("input", handleRangeChange);
    document.getElementById("endYear").addEventListener("input", handleRangeChange);
</script>
<script>
    function drawHeatmap() {
        var selectBox = document.getElementById("dataOptions");
        var selectedValue = selectBox.options[selectBox.selectedIndex].value;
        var filename;

        // Set the filename based on the selected option
        switch (selectedValue) {
            case 'raw':
                filename = "HEAT.csv";
                break;
            case 'cleaned':
                filename = "HEAT_REGRESSED.csv";
                break;
            case 'combined':
                filename = "COMBINED_DATA.csv"; // Change to your combined data filename
                break;
            default:
                // Default to raw data if none selected
                filename = "HEAT.csv";
                break;
        }

        console.log("Filename:", filename);

        // Read the selected start and end years
        var startYear = document.getElementById("startYear").value;
        var endYear = document.getElementById("endYear").value;

        console.log("Start Year:", startYear);
        console.log("End Year:", endYear);

        // Read the selected countries
        var selectedCountries = [];
        var checkboxes = document.querySelectorAll('input[type=checkbox]:checked');
        checkboxes.forEach(function (checkbox) {
            selectedCountries.push(checkbox.value);
        });

        console.log("Selected Countries:", selectedCountries);

        // Set the dimensions and margins of the graph
        var margin = { top: 80, right: 25, bottom: 30, left: 120 },
            width = 700 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom;

        console.log("Width:", width);
        console.log("Height:", height);

        // Select the existing SVG object
        var svg = d3.select("#my_dataviz svg g");

        console.log("SVG Selection:", svg);

        // Filter data based on selected years and countries
        d3.csv(filename, function (data) {
            console.log("Data:", data);

            var data = data.filter(function (d) {
                return d.Year >= startYear && d.Year <= endYear && selectedCountries.includes(d.Country);
            });

            console.log("Filtered Data:", data);

            // Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
            var myGroups = d3.map(data, function (d) { return d.Year; }).keys()
            var myVars = d3.map(data, function (d) { return d.Country; }).keys()

            console.log("X Axis Groups:", myGroups);
            console.log("Y Axis Variables:", myVars);

            var x = d3.scaleBand()
                .range([0, width])
                .domain(myGroups)
                .padding(0.05);

  
            var y = d3.scaleBand()
                .range([height, 0])
                .domain(myVars)
                .padding(0.3);

svg.select(".x-axis-label")
    .call(d3.axisBottom(x).tickSize(0))
    .select(".domain").remove();


svg.select(".y-axis-label")
    .call(d3.axisLeft(y).tickSize(0))
    .select(".domain").remove();





            // Build color scale
            var myColor = d3.scaleSequential()
                .domain([70, 76, 82, 88, 94, 100])
                .interpolator(function (value) {
                    if (value == 5) return "#dd000f";  
                    else if (value < 5 && value >= 4) return "#ff4a4a";   
                    else if (value < 4 && value >= 3) return "#ff8800";   
                    else if (value < 3 && value >= 2) return "#ebff38";   
                    else if (value < 2 && value >= 1) return "#e591ce";
                    else if (value < 1 && value >= 0) return "#8706b2";   
                    else return "#73d7ff";
                });

            console.log("Color Scale:", myColor);

            // create a tooltip
            var tooltip = d3.select("#my_dataviz .tooltip");

            console.log("Tooltip:", tooltip);

            // Update existing squares with transition
            svg.selectAll("rect")
                .data(data, function (d) { return d.Year + ':' + d.Country; })
                .transition()
                .duration(500)
                .attr("x", function (d) { return x(d.Year) })
                .attr("y", function (d) { return y(d.Country) })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", function (d) { return myColor(d.Value) });
            
            // Remove any extra squares
            svg.selectAll("rect")
                .data(data, function (d) { return d.Year + ':' + d.Country; })
                .exit()
                .remove();
                
            // Append new squares if needed
            svg.selectAll("rect")
                .data(data, function (d) { return d.Year + ':' + d.Country; })
                .enter()
                .append("rect")
                .attr("x", function (d) { return x(d.Year) })
                .attr("y", function (d) { return y(d.Country) })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", function (d) { return myColor(d.Value) });
        });
    }
</script>



</body>